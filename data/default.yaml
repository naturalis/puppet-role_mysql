# Example YAML file to override parameters using hiera or the Foreman

# Install MySQL
role_mysql::mysql_root_password: 'mypass'
role_mysql::package_name_server: 'mysql-server-5.7'
role_mysql::package_name_client: 'mysql-client-5.7'

# Set options
# innodb_file_per_table: 'on' is default from MySQL version 5.6.6
role_mysql::override_options:
  mysqld:
    bind-address: '0.0.0.0'
    max_allowed_packet: '512M'
    innodb_flush_log_at_trx_commit: '0'
    innodb_log_file_size: '1G'
    innodb_flush_method: 'O_DIRECT'
    innodb_buffer_pool_instances: '8'
    innodb_thread_concurrency: '8'
    skip_name_resolve: 'on'
    innodb_file_per_table: 'on'

# Create users
role_mysql::users:
  'analytics@%':
    ensure: 'present'
    password: 'mypass'
  'sakila@localhost':
    ensure: 'present'
    password: 'mypass'
  'sakila@%':
    ensure: 'present'
    password: 'mypass'

# Set grants
role_mysql::grants:
  'analytics@%/mysql.*':
    privileges:
      - SELECT
      - DELETE
    table: 'mysql.*'
    user: 'analytics@%'
  'sakila@localhost/sakila.*':
    privileges:
      - ALL
    table: 'sakila.*'
    user: 'sakila@localhost'
  'sakila@%/sakila.*':
    privileges:
      - ALL
    table: 'sakila.*'
    user: 'sakila@%'

# Create databases
role_mysql::db_hash:
  sakila:
    user: 'manager'
    password: 'mypass'
    host: 'localhost'
    grant:
      - SELECT
